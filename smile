#!/bin/bash
# Smile launcher script
# This script ensures the application runs with proper error handling

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"

# Check if required system packages are installed
check_dependencies() {
    local missing_deps=()
    
    # Check for xdotool
    if ! command -v xdotool &> /dev/null; then
        missing_deps+=("xdotool")
    fi
    
    # Check for Python3
    if ! command -v python3 &> /dev/null; then
        missing_deps+=("python3")
    fi
    
    # Check for GTK3 Python bindings
    if ! python3 -c "import gi; gi.require_version('Gtk', '3.0'); from gi.repository import Gtk" 2>/dev/null; then
        missing_deps+=("python3-gi gir1.2-gtk-3.0")
    fi
    
    if [ ${#missing_deps[@]} -ne 0 ]; then
        echo "Error: Missing required dependencies: ${missing_deps[*]}"
        echo ""
        echo "On Ubuntu/Debian, install with:"
        echo "  sudo apt-get install python3-gi python3-gi-cairo gir1.2-gtk-3.0 xdotool"
        echo ""
        echo "On Fedora/RHEL, install with:"
        echo "  sudo dnf install python3-gobject gtk3 python3-cairo xdotool"
        echo ""
        echo "On Arch Linux, install with:"
        echo "  sudo pacman -S python-gobject gtk3 xdotool"
        exit 1
    fi
}

# Check dependencies
check_dependencies

# Run the application
exec python3 "$SCRIPT_DIR/smile.py" "$@"
